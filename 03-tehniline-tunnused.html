<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Andmetuba - 3&nbsp; Tehniline töö tunnustega</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-faktor-string.html" rel="next">
<link href="./02-andmestiku-ylevaade.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-tehniline-tunnused.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tehniline töö tunnustega</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Andmetuba</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Saateks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-andmestike-lugemine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Andmestiku laadimine ja tunnustega tutvumine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-andmestiku-ylevaade.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Andmestikust esmase ülevaate saamine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-tehniline-tunnused.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tehniline töö tunnustega</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-faktor-string.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Töö teksti sisaldavate tunnustega</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-puuduvad-vaartused.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Puuduvad väärtused</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-andmestike-liitmine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Andmestike ühendamine ja struktuuri muutmine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-joonised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Joonised - lühiülevaade</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-kirjeldav-statistika.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Kirjeldav statistika</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-seosed-tunnustes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Seosed tunnuste vahel</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-keskmiste-vordlus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Keskmiste võrdlus</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-regressioon-lineaarne.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Regressioon - lineaarne</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Allikad</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sisukord</h2>
   
  <ul>
  <li><a href="#tunnuste-muutmine" id="toc-tunnuste-muutmine" class="nav-link active" data-scroll-target="#tunnuste-muutmine"><span class="header-section-number">3.1</span> Tunnuste muutmine</a></li>
  <li><a href="#valimine" id="toc-valimine" class="nav-link" data-scroll-target="#valimine"><span class="header-section-number">3.2</span> Tunnuste valimine</a></li>
  <li><a href="#tyybi-muutmine" id="toc-tyybi-muutmine" class="nav-link" data-scroll-target="#tyybi-muutmine"><span class="header-section-number">3.3</span> Tunnuste tüübi muutmine</a></li>
  <li><a href="#nime-muutmine" id="toc-nime-muutmine" class="nav-link" data-scroll-target="#nime-muutmine"><span class="header-section-number">3.4</span> Tunnuste nimede muutmine</a></li>
  <li><a href="#sisu-muutmine" id="toc-sisu-muutmine" class="nav-link" data-scroll-target="#sisu-muutmine"><span class="header-section-number">3.5</span> Tunnuste sisu muutmine</a>
  <ul class="collapse">
  <li><a href="#if-else" id="toc-if-else" class="nav-link" data-scroll-target="#if-else">Üksiku väärtuse muutmine</a></li>
  <li><a href="#recode" id="toc-recode" class="nav-link" data-scroll-target="#recode">Tunnuse väärtuse muutmine</a></li>
  <li><a href="#case-when" id="toc-case-when" class="nav-link" data-scroll-target="#case-when">Mitme tunnuse põhjal uute väärtuse loomine</a></li>
  <li><a href="#separete" id="toc-separete" class="nav-link" data-scroll-target="#separete">Tunnuste sisu eraldamine</a></li>
  <li><a href="#unite" id="toc-unite" class="nav-link" data-scroll-target="#unite">Tunnuste sisu ühendamine</a></li>
  <li><a href="#mitu-korraga" id="toc-mitu-korraga" class="nav-link" data-scroll-target="#mitu-korraga">Mitme tunnuse muutmine korraga</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tehniline töö tunnustega</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="tunnuste-muutmine" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="tunnuste-muutmine"><span class="header-section-number">3.1</span> Tunnuste muutmine</h2>
<p><code>Tehniline töö</code> tunnustega tähendab minu jaoks andmestiku ettevalmistust <em>sisulisemaks</em> analüüsiks. Minu jaoks on see etapp, kus piirid ettevalmistava töö ja <a href="08-kirjeldav-statistika.html#kirjeldav-stat">kirjeldava statistika</a> vahel hakkavad hägustuma, sest tunnuste väärtuste jaotust vaadatakse mõlemas osas. Seepärast on siin peatükkis juttu kohati mõlemast, sest <code>andmete puhastamisel</code> (ehk analüüsi ettevalmistavas etapis) on vaja kasutada samu võtteid, mida tehake kirjeldava statstika saamiseks. Valitakse analüüsiks sobivad tunnused, vaadatakse nende väärtuste jaotust, koostatakse uued tunnused olemasolevate tunnuste põhjalt või korrastatakse tunnuste kategooriad.</p>
</section>
<section id="valimine" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="valimine"><span class="header-section-number">3.2</span> Tunnuste valimine</h2>
<p>Tunnuste valimine tehakse selleks, et jätta kõrvale see osa andmestikust, mis tundub parasjagu ebaoluline. Ebaoluline on see osa, mida me kindlasti analüüsis ei kasuta.</p>
<p><code>Baasversioonis</code> toimub tunnuste valmine nurksulgude sees, mis sisaldab koma <code>[,]</code>. Enne koma öeldakse <code>R</code>-ile, millised <em>read</em> tuleb valida ja peale koma, millised <em>tulbad</em> (tunnused). Kui jätta tühjaks, valib <code>R</code> kõik read ja tunnused.</p>
<p><code>tidyverse</code> annab meeldejäävamad käsud <code>select()</code> ja <code>filter()</code>.</p>
<p>Miinusmärk <code>-</code> käsu sees näitab, millistest tunnustest loobuda. Näiteks <code>baasversioonis</code> käib kolme esimene tunnuse eemaldamine andmestikust nii.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>starwars[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 11
   hair_color    skin_color  eye_color birth_year sex   gender homeworld species
   &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  
 1 blond         fair        blue            19   male  mascu… Tatooine  Human  
 2 &lt;NA&gt;          gold        yellow         112   none  mascu… Tatooine  Droid  
 3 &lt;NA&gt;          white, blue red             33   none  mascu… Naboo     Droid  
 4 none          white       yellow          41.9 male  mascu… Tatooine  Human  
 5 brown         light       brown           19   fema… femin… Alderaan  Human  
 6 brown, grey   light       blue            52   male  mascu… Tatooine  Human  
 7 brown         light       blue            47   fema… femin… Tatooine  Human  
 8 &lt;NA&gt;          white, red  red             NA   none  mascu… Tatooine  Droid  
 9 black         light       brown           24   male  mascu… Tatooine  Human  
10 auburn, white fair        blue-gray       57   male  mascu… Stewjon   Human  
# ℹ 77 more rows
# ℹ 3 more variables: films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<p>Tunnuseid võib valida ka nii, et ütled <code>tunnuse nimed</code> eraldades need komaga <code>,</code> või kasutad järjestike tunnuste valimisel <code>:</code> märki.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-2" class="code-annotation-target"><a href="#annotated-cell-2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, hair_color<span class="sc">:</span>birth_year)<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-2-3" class="code-annotation-target"><a href="#annotated-cell-2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">Võta andmestik starwars ja seejärel</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2" data-code-annotation="2">vali tunnused “name” ja alates tunnusest “hair_color” kuni “birth_year” ja seejärel</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="3" data-code-annotation="3">kuva andmestiku päist</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  name           hair_color  skin_color  eye_color birth_year
  &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;
1 Luke Skywalker blond       fair        blue            19  
2 C-3PO          &lt;NA&gt;        gold        yellow         112  
3 R2-D2          &lt;NA&gt;        white, blue red             33  
4 Darth Vader    none        white       yellow          41.9
5 Leia Organa    brown       light       brown           19  
6 Owen Lars      brown, grey light       blue            52  </code></pre>
</div>
</div>
<p>Käsud <code>starts_with()</code> ja <code>ends_with()</code> lihtsustavad tunnuste valimist veelgi.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"s"</span>))<span class="sc">%&gt;%</span></span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="1">valib tunnused, mille nimi algab “s” tähega</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  skin_color  sex    species starships
  &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;list&gt;   
1 fair        male   Human   &lt;chr [2]&gt;
2 gold        none   Droid   &lt;chr [0]&gt;
3 white, blue none   Droid   &lt;chr [0]&gt;
4 white       male   Human   &lt;chr [1]&gt;
5 light       female Human   &lt;chr [0]&gt;
6 light       male   Human   &lt;chr [0]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-2" class="code-annotation-target"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"color"</span>))<span class="sc">%&gt;%</span></span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="2" data-code-annotation="1">valib tunnused, mille nimi lõpeb sõnaga “color”</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  hair_color  skin_color  eye_color
  &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;    
1 blond       fair        blue     
2 &lt;NA&gt;        gold        yellow   
3 &lt;NA&gt;        white, blue red      
4 none        white       yellow   
5 brown       light       brown    
6 brown, grey light       blue     </code></pre>
</div>
</div>
<p>Tunnuste valimine nende sisu järgi on <code>R</code>-is tunnuse filteerimine ja toimub käsuga <code>filter()</code>. Kui me ei täpsuta käsuga <code>select()</code>, siis jätakse alles kõik andmesikus olevad tunnused.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-5-2" class="code-annotation-target"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mass<span class="sc">&lt;</span><span class="dv">20</span>)<span class="sc">%&gt;%</span></span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="2" data-code-annotation="1">valitakse tunnuse mass väärtuste alusel need read, kus mass on väiksem kui 20</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Yoda          66    17 white      green      brown            896 male  mascu…
2 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<p><code>Tekst</code>i sildava tunnus väärtus peab olema kirjutatud jutumärkide <code>""</code> sisse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hair_color<span class="sc">==</span><span class="st">"white"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Yoda          66    17 white      green      brown            896 male  mascu…
2 Ki-Adi-M…    198    82 white      pale       yellow            92 male  mascu…
3 Dooku        193    80 white      fair       brown            102 male  mascu…
4 Jocasta …    167    NA white      fair       blue              NA fema… femin…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<p><code>Tekst</code>-i sisaldava tunnuse puhul võib kasutada ka <code>%in%</code> ning see toimib hästi <code>vektor</code>-itega. Loe <code>vektor</code>-ite kohta <a href="02-andmestiku-ylevaade.html#vector">siit</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hair_color<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Yoda          66    17 white      green      brown            896 male  mascu…
2 Palpatine    170    75 grey       pale       yellow            82 male  mascu…
3 Ki-Adi-M…    198    82 white      pale       yellow            92 male  mascu…
4 Dooku        193    80 white      fair       brown            102 male  mascu…
5 Jocasta …    167    NA white      fair       blue              NA fema… femin…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<p>Teksti puhul võib teinekord olla parem kasutada käsku <code>str_detect()</code>, mis tuvastab huvitava sõna esinemise andmelahtris, sest <code>andmelahter</code> ei pruugi sisaldada <em>ainult seda</em> otsitavat teksti. (Loe tekstide sisaldavate tunnuste kohta rohkem <a href="04-faktor-string.html#stringid">siit</a>)</p>
<div class="callout callout-style-simple callout-caution">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Pane tähele, et eelmise filtreerimisega (hair_color==“white”) ei tulnud välja need tegelesed, kelle juustes on halli (grey) <strong>ja mõnda teist</strong> värvi. <code>str_detect()</code> lahendab selle mure.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(hair_color, <span class="st">"grey"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Owen Lars    178   120 brown, gr… light      blue              52 male  mascu…
2 Wilhuff …    180    NA auburn, g… fair       blue              64 male  mascu…
3 Palpatine    170    75 grey       pale       yellow            82 male  mascu…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<p>Kui on soov filtreerida mitme väärtuse põhjal kasutades “on võrdne” tähist (<code>==</code>) on sage oht segi ajada <code>|</code> ja <code>&amp;</code>. Kui soovime leida kahte nahatooni (nt “fair” ja “pale”) peame kasutama <code>|</code> sümbolit <strong>ja mitte</strong> <code>&amp;</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-9-2" class="code-annotation-target"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(skin_color<span class="sc">==</span><span class="st">"fair"</span> <span class="sc">|</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-9-3" class="code-annotation-target"><a href="#annotated-cell-9-3" aria-hidden="true" tabindex="-1"></a>           skin_color<span class="sc">==</span><span class="st">"pale"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="2" data-code-annotation="1">filtreeri read, kus tunnuse väärtus on võrdne sõnaga “fair” <strong>või</strong></span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="3" data-code-annotation="2">võrdne sõnaga “pale”.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 14
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk…    172  77   blond      fair       blue            19   male  mascu…
 2 Obi-Wan…    182  77   auburn, w… fair       blue-gray       57   male  mascu…
 3 Anakin …    188  84   blond      fair       blue            41.9 male  mascu…
 4 Wilhuff…    180  NA   auburn, g… fair       blue            64   male  mascu…
 5 Han Solo    180  80   brown      fair       brown           29   male  mascu…
 6 Wedge A…    170  77   brown      fair       hazel           21   male  mascu…
 7 Jek Ton…    180 110   brown      fair       blue            NA   &lt;NA&gt;  &lt;NA&gt;  
 8 Palpati…    170  75   grey       pale       yellow          82   male  mascu…
 9 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
10 Mon Mot…    150  NA   auburn     fair       blue            48   fema… femin…
# ℹ 12 more rows
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
</section>
<section id="tyybi-muutmine" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="tyybi-muutmine"><span class="header-section-number">3.3</span> Tunnuste tüübi muutmine</h2>
<p>Mõnikord avastame, et tunnused on andmestikus nn vales klassis ning need on vaja ära muuta. Sõltuvalt sellest, milliseks tüübiks on soov tunnust muuta on käsud <code>as.numeric()</code>, <code>as.character()</code>, <code>as.factor</code>. Samad käsud toimivad ka alakriipsuga (näiteks <code>as_numeric()</code>)</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Kuupäevadeks muutmine vajab eraldi peatükki ning see on tegemisel.</p>
</div>
</div>
</div>
<p>Teen näite läbi käsuga <code>as.factor()</code>. Tunnuse <em>sex</em> tüüp on algselt <code>character</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(starwars<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>Soovime, et on tunnus <em>sex</em> oleks kategoriaalne ehk <code>faktor</code>.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Kui sa ei ole endas kindel, kas kasutad käske õigesti, tee esmalt oma andmestikust koopia ja harjuta tunnuste muutmist seal.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a>test<span class="ot">&lt;-</span>starwars</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-11-2" class="code-annotation-target"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>sex<span class="ot">&lt;-</span><span class="fu">as_factor</span>(test<span class="sc">$</span>sex)</span>
<span id="annotated-cell-11-3"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>mass<span class="ot">&lt;-</span><span class="fu">as.factor</span>(test<span class="sc">$</span>mass)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-11-4" class="code-annotation-target"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(test<span class="sc">$</span>sex)</span>
<span id="annotated-cell-11-5"><a href="#annotated-cell-11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(test<span class="sc">$</span>mass)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1" data-code-annotation="1">kopeerin andmestiku starwars ja panen talle nimeks test</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="2,3" data-code-annotation="2">muudan tunnused <code>faktor</code> tüübiks</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="4,5" data-code-annotation="3">kontrollin kas muutmine õnnestus</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"
[1] "factor"</code></pre>
</div>
</div>
<p><code>factor</code> tunnuste muutmine <code>numeric</code> tunnusteks tegemisel tuleb tunnus teha esmalt <code>character</code> tüüpi tunnuseks. Seda saab teha kasutades koos käske <code>as.character()</code> ja <code>as.numeric()</code> koos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>mass<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(test<span class="sc">$</span>mass))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(test<span class="sc">$</span>mass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Vaata, kuidas käib <a href="#mitu-korraga">mitme tunnuse üheaegne muutmine</a>.</p>
</section>
<section id="nime-muutmine" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="nime-muutmine"><span class="header-section-number">3.4</span> Tunnuste nimede muutmine</h2>
<p>Vaatame andmestiku Orange nimesid käsuga <code>names()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Orange)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tree"          "age"           "circumference"</code></pre>
</div>
</div>
<p>Soovin nad muuta korraga ära tehes esmalt vektori “uued_nimed” uutest nimedest. (Loe vektorite kohta <a href="02-andmestiku-ylevaade.html#vector">siit</a>.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>uued_nimed<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"puu"</span>, <span class="st">"vanus"</span>, <span class="st">"ymbermoot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>names()</code> käsuga saan muuta ära ka andmestiku nimed öeldes, millisest <code>vector</code>ist uued nimed võtta.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Orange)<span class="ot">&lt;-</span>uued_nimed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vaatan, kas tunnuste nimed läksid õigesti taaskasutades käsku <code>head()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Orange)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  puu vanus ymbermoot
1   1   118        30
2   1   484        58
3   1   664        87
4   1  1004       115
5   1  1231       120
6   1  1372       142</code></pre>
</div>
</div>
<p>Eemaldan <code>vektor</code>-i “uued_nimed” <code>Environment</code> keskkonnast.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(uued_nimed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nimesid saab muuta ka <em>valikuliselt</em> käsuga <code>rename()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Orange<span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">uus_nimi=</span>puu,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ym=</span>ymbermoot)<span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  uus_nimi vanus ym
1        1   118 30
2        1   484 58</code></pre>
</div>
</div>
</section>
<section id="sisu-muutmine" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="sisu-muutmine"><span class="header-section-number">3.5</span> Tunnuste sisu muutmine</h2>
<p>Tunnuste sisu<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> muutmisel teeme kas <strong>täitsa uued tunnused</strong> olemasoleva põhjalt või <strong>kirjutame olemasoleva tunnuse üle</strong>.</p>
<p>Kui on soov muuta numbrilist tunnust mingi teise numbri või numbrilise tunnusega, saab seda teha väga lihtsalt ja kasutada <code>R</code>-i kui tavalist kalkulaatorit. Näiteks teisendame tunnuse height sentimeetritest meetriteks jagades tunnust 100-ga.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">$</span>pikkus_m<span class="ot">&lt;-</span>starwars<span class="sc">$</span>height<span class="sc">/</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(height, pikkus_m)<span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  height pikkus_m
   &lt;int&gt;    &lt;dbl&gt;
1    172     1.72
2    167     1.67
3     96     0.96
4    202     2.02
5    150     1.5 
6    178     1.78</code></pre>
</div>
</div>
<p>Arvutada saab ka kahe olemasoleva tunnuse järgi tehes samamoodi tehe. Arvutame tegelaste kehamassindeksi(kmi). Teeme selleks arvutustehte, kus jagame kehakaalu pikkuse ruuduga <code>^2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">$</span>kmi<span class="ot">&lt;-</span>starwars<span class="sc">$</span>mass<span class="sc">/</span>(starwars<span class="sc">$</span>pikkus_m)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, kmi)<span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  name             kmi
  &lt;chr&gt;          &lt;dbl&gt;
1 Luke Skywalker  26.0
2 C-3PO           26.9
3 R2-D2           34.7</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><code>R</code> teeb selliseid arvutusi nagu talle ütled. <code>R</code> <strong>ei ole kriitiline</strong> ega ütle sulle, et kehamassi-indeksi arvutusvalem on mõeldud <em>inimeste</em> <em>kehakaalu ja pikkuse</em> suhte arvutamiseks ning järeldusi droidide või teiste liikide esindajate kohta teha ei saa. Nii nagu iga analüüsimeetodi kasutamisel peab ise mõtlema, kas see on parasjagu sobilik meetod ja tunnuste kasutamine meetodi sees loogiline.</p>
</div>
</div>
</div>
<p>Tunnuste sisu muutmiseks on käsk <code>mutate()</code> koos mõne järgmise käsuga:</p>
<ul>
<li><code>if_else()</code> - juhul kui käsk sobib hästi üksiku tunnuse muutmiseks kui ka mitme tunnuse üheaegseks muutmiseks. <a href="#if-else">vaata näidet</a></li>
<li><code>recode()</code> - juhul kui soovime muuta tunnuse väärtusi <a href="#recode">vaata näidet</a></li>
<li><code>case_when()</code> - sobib keerulistema lausete tegemiseks uute või olemasolevate tunnuste väärtuste muutmisel. <a href="#case-when">Vaata näidet</a></li>
</ul>
<p>Kuid vajalik on tunda käske <code>separate()</code> ja <code>unite()</code>. Vaata nende käskude kasutamist <a href="#unite">siit</a></p>
<p>Tunnuste <code>kategooria</code>-te ühendamiseks vaata ka <a href="04-faktor-string.html#factor-collapse">siia</a>. Teksti sisaldavate tunnustega töötamisel vaata <a href="04-faktor-string.html#stringid">siia</a>.</p>
<section id="if-else" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="if-else">Üksiku väärtuse muutmine</h3>
<p>Tunnuse väärtus on tunnuse sisu. Näiteks tunnuse “name” väärtusteks on tegelaste <em>nimed</em>. “Luke Skywalker” on tunnuse “name” üks väärtus.</p>
<p>Näiteks soovime muuta tegelast “Gregor Typho” ja öelda, et ta on liigilt (tunnus “species”) inimene.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-23"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-23-1" class="code-annotation-target"><a href="#annotated-cell-23-1" aria-hidden="true" tabindex="-1"></a>test<span class="ot">&lt;-</span>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-23-2" class="code-annotation-target"><a href="#annotated-cell-23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species=</span><span class="fu">if_else</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-23-3" class="code-annotation-target"><a href="#annotated-cell-23-3" aria-hidden="true" tabindex="-1"></a>    name<span class="sc">==</span><span class="st">"Gregar Typho"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-23-4" class="code-annotation-target"><a href="#annotated-cell-23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Inimene"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-23-5" class="code-annotation-target"><a href="#annotated-cell-23-5" aria-hidden="true" tabindex="-1"></a>    species))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="1" data-code-annotation="1">Loo koopia nimega “test” andmestikust “starwars”;</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="2" data-code-annotation="2">muuda tunnust “species” juhul kui</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="3" data-code-annotation="3">pärast kontrolli, et tunnuse “name” väärtus on võrdne tekstiga “Gregar Typho”;</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="4" data-code-annotation="4">selgub, et see<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> on tõesti on nii, siis pane väärtuseks “Inimene”;</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="5" data-code-annotation="5">kui see ei ole nii, siis kasuta seda väärtust, mis oli.</span>
</dd>
</dl>
</div>
</div>
<p>Nüüd vaatan, kas muutmine õnnestus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, species)<span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name<span class="sc">==</span><span class="st">"Gregar Typho"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  name         species
  &lt;chr&gt;        &lt;chr&gt;  
1 Gregar Typho Inimene</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Alati kontrolli oma tehtud töö üle, kas muutsid ikka seda tunnust ja sellisel viisil, mida muuta soovisid. Kui kontrollid oma tööd nii, et vaatad ainult seda tunnust, mida muuta tahtsid, ei leia sa üles võimalikke vigu, mida tunnuste muutmisel teha võisid.</p>
</div>
</div>
</div>
<p>Sama asja tegemine <code>baasversioonis</code> käib käsu <code>which()</code>abil ning asendan kategooria “Inimene” kategooriaga “Human”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>species[<span class="fu">which</span>(test<span class="sc">$</span>name<span class="sc">==</span><span class="st">"Gregar Typho"</span>)] <span class="ot">&lt;-</span> <span class="st">"Human"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Käsku <code>if_else()</code> saab kasutada edukat ka terve vektori muutmiseks ja mitte ainult üksiku väärtuse muutmiseks.</p>
</div>
</div>
</div>
</section>
<section id="recode" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="recode">Tunnuse väärtuse muutmine</h3>
<p>Tunnuse väärtuste muutmiseks saab kasutada ka käsu <code>recode()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(starwars<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 feminine masculine 
       17        66 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-27"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-27-1" class="code-annotation-target"><a href="#annotated-cell-27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recode</span>(starwars<span class="sc">$</span>gender,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-27-2" class="code-annotation-target"><a href="#annotated-cell-27-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">feminine=</span> <span class="st">"naiselik"</span>,</span>
<span id="annotated-cell-27-3"><a href="#annotated-cell-27-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">masculine=</span> <span class="st">"mehelik"</span>)<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-27-4" class="code-annotation-target"><a href="#annotated-cell-27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-27" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="1" data-code-annotation="1">Kodeeri starwars andmestikust tunnus gender ringi</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="2,3" data-code-annotation="2">Annan uute kategooriate nimed ja seejärel</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="4" data-code-annotation="3">Vaatan, kas muutmine õnnestus</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>.
 mehelik naiselik 
      66       17 </code></pre>
</div>
</div>
</section>
<section id="case-when" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="case-when">Mitme tunnuse põhjal uute väärtuse loomine</h3>
<p>Oletame, et soovin saada ülevaadet lühikestest inimesest nii, et on kaks kategooriat “pikk inimene” ja “lühike inimene”. Tahan teha selleks uut tunnust nimega “pikkuse_liik”. Kategooria “pikk inimene” alla soovin lisada kõik inimesed, kes on vähemalt 160 cm pikad. Teise kategooriasse “lühike inimene” ja soovin lisada kõik inimesed, kes on lühemad kui 160cm. Soovin vaadata üle, kas paljude tegelaste liik või mass on teadmata, et emba-kumba vajadusel täpsustama minna (st küsima liiki või mõõtma pikkust).</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-28-1" class="code-annotation-target"><a href="#annotated-cell-28-1" aria-hidden="true" tabindex="-1"></a>test<span class="ot">&lt;-</span>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-28-2" class="code-annotation-target"><a href="#annotated-cell-28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pikkuse_liik=</span><span class="fu">case_when</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-28-3" class="code-annotation-target"><a href="#annotated-cell-28-3" aria-hidden="true" tabindex="-1"></a>    species<span class="sc">==</span><span class="st">"Human"</span> <span class="sc">&amp;</span> height <span class="sc">&gt;</span> <span class="dv">159</span> <span class="sc">~</span> <span class="st">"pikk inimene"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-28-4" class="code-annotation-target"><a href="#annotated-cell-28-4" aria-hidden="true" tabindex="-1"></a>    species<span class="sc">==</span><span class="st">"Human"</span> <span class="sc">&amp;</span> height <span class="sc">&lt;</span> <span class="dv">160</span> <span class="sc">~</span> <span class="st">"lühike inimene"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-28-5" class="code-annotation-target"><a href="#annotated-cell-28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(species) <span class="sc">~</span> <span class="st">"ei tea, kas on inimene"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-28-6" class="code-annotation-target"><a href="#annotated-cell-28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(height) <span class="sc">~</span> <span class="st">"ei tea, kui pikk on"</span></span>
<span id="annotated-cell-28-7"><a href="#annotated-cell-28-7" aria-hidden="true" tabindex="-1"></a>  ))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-28" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="1" data-code-annotation="1">Loo koopia nimega “test” andmestikust “starwars”;</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="2" data-code-annotation="2">muuda andmestikku (ja loo sinna) <code>tunnus</code> “pikkus_liik” juhul kui <code>tunnus</code>-te;</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="3" data-code-annotation="3">species sisu on “Human” <strong>ja samal ajal</strong> “height” on suurem kui 159 (<em>ehk vähemalt 160</em>), määra <code>kategooria</code> väärtuseks “pikk inimene”;</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="4" data-code-annotation="4">species sisu on “Human” <strong>ja samal ajal</strong> “height” on kuni 160 (<em>ehk kõrgeim väärtus on 159</em>), määra <code>kategooria</code> väärtuseks “lühike inimene”;</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="5" data-code-annotation="5">kui species on <code>NA</code>, määra <code>kategooria</code> väärtuseks “ei tea, kas on inimene”;</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="6" data-code-annotation="6">kui species on <code>NA</code>, määra <code>kategooria</code> väärtuseks “ei tea, kui pikk on”.</span>
</dd>
</dl>
</div>
</div>
<p>Vaatan, kas tekkis tunnuse alla neli kategooriat ja nende alla ka inimesi.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test<span class="sc">$</span>pikkuse_liik)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
ei tea, kas on inimene    ei tea, kui pikk on         lühike inimene 
                     4                      6                      2 
          pikk inimene 
                    28 </code></pre>
</div>
</div>
<p>Nüüd aga otsustan, et <strong>kirjutan olemasoleva tunnuse üle</strong> nii, et need kelle pikkus või liik on teadmata (<code>NA</code>), lähevad <code>kategooria</code> alla “ei saa kategoriseerdia” ning kõigi ülejäänutel jääb <code>kategooria</code> samaks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-30"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-30-1" class="code-annotation-target"><a href="#annotated-cell-30-1" aria-hidden="true" tabindex="-1"></a>test<span class="ot">&lt;-</span>test<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-30-2" class="code-annotation-target"><a href="#annotated-cell-30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pikkuse_liik=</span><span class="fu">case_when</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-30-3" class="code-annotation-target"><a href="#annotated-cell-30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(species) <span class="sc">|</span> <span class="fu">is.na</span> (height) <span class="sc">~</span> <span class="st">"ei saa kategoriseerida"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-30-4" class="code-annotation-target"><a href="#annotated-cell-30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> pikkuse_liik</span>
<span id="annotated-cell-30-5"><a href="#annotated-cell-30-5" aria-hidden="true" tabindex="-1"></a>  ))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-30" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="1" data-code-annotation="1">Kirjuta andmestik “test” üle;</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="2" data-code-annotation="2">muuda <em>olemasolevat</em> <code>tunnus</code>-t “pikkus_liik” juhul kui <code>tunnus</code>-te;</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="3" data-code-annotation="3">species sisu on teadmata (<code>NA</code>) <strong>või</strong> heigth sisu on teadmata (<code>NA</code>), määra neile <code>kategooria</code> “ei saa kategoriseerida”;</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="4" data-code-annotation="4">ülejäänute <code>vaatlus</code>-tel jäta <code>kategooria</code> nii nagu on pikkuse_liik.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test<span class="sc">$</span>pikkuse_liik)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
ei saa kategoriseerida         lühike inimene           pikk inimene 
                    10                      2                     28 </code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-caution">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Jäta meelde, et kõik ülejäänud read, mis ei sobitu ühegi kategooria alla jäävad tühjaks ehk NA.</p>
</div>
</div>
</div>
</section>
<section id="separete" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="separete">Tunnuste sisu eraldamine</h3>
<p>Soovin eraldada tunnuse “name” sisu nii, et ühes tulbas on eesnimed ja teised ainult perekonnanimed. Selleks on käsk <code>separate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-32"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-32-1" class="code-annotation-target"><a href="#annotated-cell-32-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-32-2" class="code-annotation-target"><a href="#annotated-cell-32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col=</span>name,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-32-3" class="code-annotation-target"><a href="#annotated-cell-32-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"eesnimi"</span>, <span class="st">"perenimi"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-32-4" class="code-annotation-target"><a href="#annotated-cell-32-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">" "</span>)<span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-32-5" class="code-annotation-target"><a href="#annotated-cell-32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-32" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="1" data-code-annotation="1">Ütleme, millise andmestiku,</span>
</dd>
<dt data-target-cell="annotated-cell-32" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="2" data-code-annotation="2">millist tunnust eraldame;</span>
</dd>
<dt data-target-cell="annotated-cell-32" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="3" data-code-annotation="3">mis saavad olema nende uute tunnuste nimed ja</span>
</dd>
<dt data-target-cell="annotated-cell-32" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="4" data-code-annotation="4">mille <em>kaudu</em> eraldada (tühik <code>" "</code>) ja siis</span>
</dd>
<dt data-target-cell="annotated-cell-32" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="5" data-code-annotation="5">vaatame siin näites kohe ka päist, kas muutmine õnnestus.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 17
  eesnimi perenimi height  mass hair_color skin_color eye_color birth_year sex  
  &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
1 Luke    Skywalk…    172    77 blond      fair       blue            19   male 
2 C-3PO   &lt;NA&gt;        167    75 &lt;NA&gt;       gold       yellow         112   none 
3 R2-D2   &lt;NA&gt;         96    32 &lt;NA&gt;       white, bl… red             33   none 
4 Darth   Vader       202   136 none       white      yellow          41.9 male 
5 Leia    Organa      150    49 brown      light      brown           19   fema…
6 Owen    Lars        178   120 brown, gr… light      blue            52   male 
# ℹ 8 more variables: gender &lt;chr&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;,
#   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, pikkus_m &lt;dbl&gt;, kmi &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Pane tähele, et eraldatav tunnus kaob andmestikust ära. Kui soovid alles jätta originaaltunnuse, siis tee sellest esmalt andmestikku koopia.</p>
</div>
</div>
</div>
<p>Eraldajaks (<code>sep=</code>) võib olla ka number. Näiteks tahame eraldada andmestiku <code>gss_cat</code> tunnust “year” nii, et esimeses tulbas on “sajand” ja teises “kümnend”. Esmalt võtame andmestiku kasutusele ja vaatame esimest kolme rida.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"gss_cat"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gss_cat,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
   year marital         age race  rincome        partyid     relig denom tvhours
  &lt;int&gt; &lt;fct&gt;         &lt;int&gt; &lt;fct&gt; &lt;fct&gt;          &lt;fct&gt;       &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;
1  2000 Never married    26 White $8000 to 9999  Ind,near r… Prot… Sout…      12
2  2000 Divorced         48 White $8000 to 9999  Not str re… Prot… Bapt…      NA
3  2000 Widowed          67 White Not applicable Independent Prot… No d…       2</code></pre>
</div>
</div>
<p>Nüüd eraldame tunnuse nii, et kirjutame alates mitmendast tähemärgist eraldamine teha tuleb (antud näite puhul pärast teist tähemärki).</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-34"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-34-1"><a href="#annotated-cell-34-1" aria-hidden="true" tabindex="-1"></a>gss_cat<span class="sc">%&gt;%</span></span>
<span id="annotated-cell-34-2"><a href="#annotated-cell-34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col=</span>year,</span>
<span id="annotated-cell-34-3"><a href="#annotated-cell-34-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"sajand"</span>, <span class="st">"kymnend"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-34" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-34-4" class="code-annotation-target"><a href="#annotated-cell-34-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="dv">2</span>)<span class="sc">%&gt;%</span></span>
<span id="annotated-cell-34-5"><a href="#annotated-cell-34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-34" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-34" data-code-lines="4" data-code-annotation="1">Eralda alates pärast teist tähemärki</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 10
  sajand kymnend marital         age race  rincome   partyid relig denom tvhours
  &lt;chr&gt;  &lt;chr&gt;   &lt;fct&gt;         &lt;int&gt; &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;
1 20     00      Never married    26 White $8000 to… Ind,ne… Prot… Sout…      12
2 20     00      Divorced         48 White $8000 to… Not st… Prot… Bapt…      NA
3 20     00      Widowed          67 White Not appl… Indepe… Prot… No d…       2</code></pre>
</div>
</div>
<p>Vaata ka alapeatükki <a href="#str_sub">stringi eraldamine</a>.</p>
</section>
<section id="unite" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="unite">Tunnuste sisu ühendamine</h3>
<p>Soovin ühendada kahe tunnuse väärtuseid nii, et neist tekib üks uus tunnus. Näiteks tahan panna kokku starwars tegelased nende liigi (species) ja kodumaailma (homeworld) järgi. Seda saab teha käsuga <code>unite()</code>. See on sarnale käsule <code>separate()</code>, kuid <em>nagu</em> pööratult.</p>
<ul>
<li>Esmalt ütled ühendamiseks uue <code>tunnuse nime</code>,</li>
<li>seejäre, milliste tunnuste <code>sisu</code> sinna ühendada,</li>
<li>ja kas või mis peaks olema ühendatava tunnuste väärtuste vahel.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-35"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-35-1"><a href="#annotated-cell-35-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<span id="annotated-cell-35-2"><a href="#annotated-cell-35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="at">col=</span>paritolu,</span>
<span id="annotated-cell-35-3"><a href="#annotated-cell-35-3" aria-hidden="true" tabindex="-1"></a>        homeworld, species,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-35-4" class="code-annotation-target"><a href="#annotated-cell-35-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">", "</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-35-5"><a href="#annotated-cell-35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, paritolu)<span class="sc">%&gt;%</span></span>
<span id="annotated-cell-35-6"><a href="#annotated-cell-35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-35" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="4" data-code-annotation="1">pane tähele, et siin on koma järele lisatud tühik</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  name           paritolu       
  &lt;chr&gt;          &lt;chr&gt;          
1 Luke Skywalker Tatooine, Human
2 C-3PO          Tatooine, Droid
3 R2-D2          Naboo, Droid   
4 Darth Vader    Tatooine, Human
5 Leia Organa    Alderaan, Human
6 Owen Lars      Tatooine, Human</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Sarnaselt <code>separate()</code> käsule kaotab <code>unite()</code> käsk liidetavad tunnused andmestikust ära. Kui sa seda ei soovi, tee esmalt tunnustest andmestikku koopia.</p>
</div>
</div>
</div>
<p>Juhul kui ei soovi, et kahe liidetava tunnuse väärtuse vahel oleks mõni eraldav tähemärk, pane eraldajaks jutumärgid ilma tühikuta <code>""</code> .</p>
</section>
<section id="mitu-korraga" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="mitu-korraga">Mitme tunnuse muutmine korraga</h3>
<p>Abiks on käsk <code>across()</code> ja <code>where()</code> üheaegne kasutamine. Muudame näiteks kõik character tüüpi tunnused factoriteks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 16
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;          &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; 
 1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
 2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
 3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
 4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
 5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
 6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
 7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
 8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
 9 Biggs D…    183    84 black      light      brown           24   male  mascu…
10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
# ℹ 77 more rows
# ℹ 7 more variables: homeworld &lt;fct&gt;, species &lt;fct&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;, pikkus_m &lt;dbl&gt;, kmi &lt;dbl&gt;</code></pre>
</div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Kasutan mugavama lugemise huvides sünonüümidena tunnuse sisu ja tunnuse väärtus.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Ehk tunnuse “name” lahter võrdne tekstiga “Gregar Typho”<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02-andmestiku-ylevaade.html" class="pagination-link" aria-label="Andmestikust esmase ülevaate saamine">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Andmestikust esmase ülevaate saamine</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-faktor-string.html" class="pagination-link" aria-label="Töö teksti sisaldavate tunnustega">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Töö teksti sisaldavate tunnustega</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>